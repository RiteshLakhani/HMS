@model Hospital_Management_System.Models.PaymentModel

@{
    ViewData["Title"] = ViewData["PageTitle"] ?? "Payment Form";
}

<div class="container mt-5">
    <div class="card shadow-lg border-0 rounded-3">
        <div class="card-header bg-primary-purple text-white text-center py-3">
            <h2 class="mb-0">@ViewData["PageTitle"]</h2>
        </div>
        <div class="card-body p-4">
            <!-- Validation Summary -->
            <div asp-validation-summary="All" class="text-danger"></div>

            <!-- Success and Error Messages -->
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success">
                    @TempData["SuccessMessage"]
                </div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger">
                    @TempData["ErrorMessage"]
                </div>
            }

            <form asp-controller="Payments" asp-action="Save" method="post" class="row g-4">
                <input type="hidden" asp-for="PaymentID" />

                <!-- Patient and Doctor Selection -->
                    <div class="col-md-6">
                        <label class="form-label">Patient Name</label>
                        <select asp-for="PatientID" class="form-select input-field" required>
                            <option value="">Select Patient</option>
                            @foreach (var patient in ViewBag.PatientList as List<Hospital_Management_System.Models.PatientsDropDown>)
                            {
                                <option value="@patient.PatientID" data-name="@patient.PatientName">@patient.PatientName</option>
                            }
                        </select>
                        <input type="hidden" asp-for="PatientName" id="PatientName" />
                        <span asp-validation-for="PatientID" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Doctor Name</label>
                        <select asp-for="DoctorID" class="form-select input-field" required>
                            <option value="">Select Doctor</option>
                            @foreach (var doctor in ViewBag.DoctorList as List<Hospital_Management_System.Models.DoctorsDropDown>)
                            {
                                <option value="@doctor.DoctorID" data-name="@doctor.DoctorName">@doctor.DoctorName</option>
                            }
                        </select>
                        <input type="hidden" asp-for="DoctorName" id="DoctorName" />
                        <span asp-validation-for="DoctorID" class="text-danger"></span>
                    </div>

                <!-- Department and Service Name -->
                
                    <div class="col-md-6">
                        <label class="form-label">Department</label>
                        <select asp-for="Department" class="form-select input-field" required>
                            <option value="">Select Department</option>
                            <option value="Neuro">Neuro</option>
                            <option value="Ortho">Ortho</option>
                            <option value="General">General</option>
                        </select>
                        <span asp-validation-for="Department" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Service Name</label>
                        <select asp-for="ServiceName" class="form-select input-field" required>
                            <option value="">Select Service</option>
                            <option value="General Consultation">General Consultation</option>
                            <option value="Surgery">Surgery</option>
                            <option value="Diagnostic Imaging">Diagnostic Imaging</option>
                            <option value="Blood Test">Blood Test</option>
                            <option value="X-ray">X-ray</option>
                            <option value="MRI Scan">MRI Scan</option>
                            <option value="Ultrasound">Ultrasound</option>
                            <option value="Emergency Care">Emergency Care</option>
                            <option value="Physiotherapy">Physiotherapy</option>
                            <option value="Laboratory Tests">Laboratory Tests</option>
                        </select>
                        <span asp-validation-for="ServiceName" class="text-danger"></span>
                    </div>
               

                <!-- Admission and Discharge Dates -->
               
                    <div class="col-md-6">
                        <label class="form-label">Admission Date</label>
                        <input asp-for="AdmissionDate" type="date" class="form-control input-field" required />
                        <span asp-validation-for="AdmissionDate" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Discharge Date</label>
                        <input asp-for="DischargeDate" type="date" class="form-control input-field" required />
                        <span asp-validation-for="DischargeDate" class="text-danger"></span>
                    </div>
               

                <!-- Cost, Advance, Discount, and Final Amount -->
             
                    <div class="col-md-6">
                        <label class="form-label">Cost of Treatment</label>
                        <input asp-for="CostOfTreatment" type="number" class="form-control input-field" min="0" placeholder="Enter Cost" oninput="calculateAmount()" required />
                        <span asp-validation-for="CostOfTreatment" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Advanced Paid</label>
                        <input asp-for="AdvancedPaid" type="number" class="form-control input-field" min="0" placeholder="Enter Advance" oninput="calculateAmount()" required />
                        <span asp-validation-for="AdvancedPaid" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Discount</label>
                        <input asp-for="Discount" type="number" class="form-control input-field" min="0" placeholder="Enter Discount" oninput="calculateAmount()" id="Discount" />
                        <span asp-validation-for="Discount" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Final Amount</label>
                        <input asp-for="Amount" type="number" class="form-control input-field" min="0" readonly id="Amount" />
                        <span asp-validation-for="Amount" class="text-danger"></span>
                    </div>
               

                <!-- Payment Date and Status -->
                
                    <div class="col-md-6">
                        <label class="form-label">Payment Date</label>
                        <input asp-for="PaymentDate" type="date" class="form-control input-field" required />
                        <span asp-validation-for="PaymentDate" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Payment Status</label>
                        <select asp-for="PaymentStatus" class="form-select input-field" id="PaymentStatus" onchange="toggleDiscount()" required>
                            <option value="">Select Status</option>
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                        </select>
                        <span asp-validation-for="PaymentStatus" class="text-danger"></span>
                    </div>
              

                <!-- Payment Method and Type -->
                
                    <div class="col-md-6">
                        <label class="form-label">Payment Method</label>
                        <select asp-for="PaymentMethod" class="form-select input-field" id="PaymentMethod" onchange="toggleCardOrCheckNoField()" required>
                            <option value="">Select Payment Method</option>
                            <option value="Card">Card</option>
                            <option value="Cash">Cash</option>
                        </select>
                        <span asp-validation-for="PaymentMethod" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Payment Type</label>
                        <select asp-for="PaymentType" class="form-select input-field" required>
                            <option value="">Select Payment Type</option>
                            <option value="PartialPayment">Partial Payment</option>
                            <option value="FullPayment">Full Payment</option>
                        </select>
                        <span asp-validation-for="PaymentType" class="text-danger"></span>
                    </div>
              

                <!-- Card or Check Number -->
                    <div class="col-md-6 mb-3" id="CardOrCheckNoGroup">
                        <label class="form-label">Card or Check No</label>
                        <input asp-for="CardOrCheckNo" class="form-control input-field" id="CardOrCheckNo" placeholder="Enter Card or Check Number" />
                        <span asp-validation-for="CardOrCheckNo" class="text-danger"></span>
                    </div>
                

                <!-- Confirmation Checkbox -->
                <div class="form-check col-md-6 mt-3 mr-a">
                    <input asp-for="IsConfirmed" type="checkbox" class="form-check-input" />
                    <label class="form-check-label">Is Confirmed</label>
                    <span asp-validation-for="IsConfirmed" class="text-danger"></span>
                </div>

                <!-- Buttons -->
                <div class="col-12 text-center mt-3">
                    <button type="submit" class="btn btn-success action-button">Save</button>
                    <a href="@Url.Action("Index", "Payments")" class="btn btn-secondary action-button ms-3">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById("PatientID").addEventListener("change", function () {
            const selectedOption = this.options[this.selectedIndex];
            document.getElementById("PatientName").value = selectedOption.getAttribute("data-name");
        });

        document.getElementById("DoctorID").addEventListener("change", function () {
            const selectedOption = this.options[this.selectedIndex];
            document.getElementById("DoctorName").value = selectedOption.getAttribute("data-name");
        });

        function toggleCardOrCheckNoField() {
            var paymentMethod = document.getElementById("PaymentMethod").value;
            var cardOrCheckNoGroup = document.getElementById("CardOrCheckNoGroup");
            var cardOrCheckNo = document.getElementById("CardOrCheckNo");
            if (paymentMethod === "Cash") {
                cardOrCheckNoGroup.style.display = "none";
                cardOrCheckNo.disabled = true;
            } else {
                cardOrCheckNoGroup.style.display = "block";
                cardOrCheckNo.disabled = false;
            }
        }

        function calculateAmount() {
            var cost = parseFloat(document.getElementById("CostOfTreatment").value) || 0;
            var advance = parseFloat(document.getElementById("AdvancedPaid").value) || 0;
            var discount = parseFloat(document.getElementById("Discount").value) || 0;
            document.getElementById("Amount").value = (cost - advance - discount).toFixed(2);
        }

        function toggleDiscount() {
            var paymentStatus = document.getElementById("PaymentStatus").value;
            var discountField = document.getElementById("Discount");
            if (paymentStatus === "Paid") {
                discountField.disabled = true;
                discountField.value = 0;
                calculateAmount();
            } else {
                discountField.disabled = false;
            }
        }

        window.onload = function() {
            toggleCardOrCheckNoField();
            toggleDiscount();
        };
    </script>
    <partial name="_ValidationScriptsPartial" />
}

<style>
    .bg-primary-purple {
        background: linear-gradient(135deg, #4B0082, #6A0DAD) !important;
    }

    .container {
        max-width: 900px;
    }

    .card {
        border-radius: 12px;
        padding: 20px;
    }

    .form-label {
        font-weight: 600;
    }

    .input-field {
        border-radius: 8px;
        padding: 12px;
        font-size: 16px;
        height: 48px;
        width: 100%;
    }

    .textarea-field {
        height: auto !important;
        min-height: 100px;
    }

    .col-md-6, .col-md-12 {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .action-button {
        font-size: 18px;
        border-radius: 8px;
        padding: 12px 24px;
    }
</style>